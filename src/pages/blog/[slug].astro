---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";

// Define the props type with a required `post` property
export interface Props {
  post: any;
}

// Get all blog posts for generating static routes
export async function getStaticPaths() {
  const blogEntries = await getCollection("blog");

  return blogEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { post: entry },
  }));
}

// Access the post data from props
const { post } = Astro.props;
const { Content } = await post.render();

// Format the date for display
const formattedDate = new Date(post.data.date).toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<Layout title={`${post.data.title} - Kabir Dikko`}>
  <div class="page-container max-w-4xl mx-auto">
    <div class="mb-8">
      <a
        href="/blog"
        class="flex items-center text-primary hover:underline mb-4"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="mr-1"><path d="m15 18-6-6 6-6"></path></svg
        >
        Back to Blog
      </a>

      {
        post.data.image && (
          <div class="w-full aspect-video rounded-xl overflow-hidden mb-8">
            <img
              src={post.data.image}
              alt={post.data.title}
              class="w-full h-full object-cover"
            />
          </div>
        )
      }

      <div class="flex items-center gap-3 mb-4">
        <span class="px-3 py-1 bg-primary/10 text-primary text-sm rounded-full">
          {post.data.category}
        </span>
        <span class="text-muted-foreground text-sm flex items-center">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="mr-1"
            ><rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect><line
              x1="16"
              x2="16"
              y1="2"
              y2="6"></line><line x1="8" x2="8" y1="2" y2="6"></line><line
              x1="3"
              x2="21"
              y1="10"
              y2="10"></line></svg
          >
          {formattedDate}
        </span>
      </div>

      <h1 class="text-3xl md:text-4xl font-bold mb-4">{post.data.title}</h1>

      <div class="flex items-center gap-3 mb-8">
        <div
          class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="text-primary"
            ><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle
              cx="12"
              cy="7"
              r="4"></circle></svg
          >
        </div>
        <div>
          <div class="font-medium">{post.data.author}</div>
          <div class="text-sm text-muted-foreground">DevOps Engineer</div>
        </div>
      </div>
    </div>

    <div
      class="blog-content glass-card p-8 prose dark:prose-invert max-w-none prose-headings:text-foreground prose-a:text-primary"
    >
      <Content />
    </div>

    <div class="mt-12">
      <h3 class="text-xl font-bold mb-4">Tags</h3>
      <div class="flex flex-wrap gap-2">
        {
          post.data.tags.map((tag: string) => (
            <a
              href={`/blog/tags/${tag.toLowerCase()}`}
              class="px-3 py-1 bg-accent hover:bg-primary hover:text-primary-foreground transition-colors text-sm rounded-full"
            >
              {tag}
            </a>
          ))
        }
      </div>
    </div>

    <div class="mt-12 border-t border-border pt-12">
      <h3 class="text-xl font-bold mb-6">Share this article</h3>
      <div class="flex gap-4">
        <a
          href={`https://twitter.com/intent/tweet?text=${post.data.title}&url=${Astro.url}`}
          target="_blank"
          rel="noopener noreferrer"
          class="bg-primary/10 p-3 rounded-lg hover:bg-primary/20 transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="text-primary"
            ><path
              d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"
            ></path></svg
          >
        </a>
        <a
          href={`https://www.linkedin.com/sharing/share-offsite/?url=${Astro.url}`}
          target="_blank"
          rel="noopener noreferrer"
          class="bg-primary/10 p-3 rounded-lg hover:bg-primary/20 transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="text-primary"
            ><path
              d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"
            ></path><rect width="4" height="12" x="2" y="9"></rect><circle
              cx="4"
              cy="4"
              r="2"></circle></svg
          >
        </a>
        <a
          href={`mailto:?subject=${post.data.title}&body=Check out this article: ${Astro.url}`}
          class="bg-primary/10 p-3 rounded-lg hover:bg-primary/20 transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="text-primary"
            ><rect width="20" height="16" x="2" y="4" rx="2"></rect><path
              d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path></svg
          >
        </a>
      </div>
    </div>
  </div>
</Layout>

<style is:global>
  .blog-content h1,
  .blog-content h2,
  .blog-content h3,
  .blog-content h4,
  .blog-content h5,
  .blog-content h6 {
    margin-top: 1.5em;
    margin-bottom: 0.75em;
    font-weight: 700;
    line-height: 1.2;
  }

  .blog-content h1 {
    font-size: 2rem;
  }

  .blog-content h2 {
    font-size: 1.75rem;
  }

  .blog-content h3 {
    font-size: 1.5rem;
  }

  .blog-content p {
    margin-bottom: 1.25em;
    line-height: 1.7;
  }

  .blog-content a {
    color: var(--primary);
    text-decoration: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
  }

  .blog-content a:hover {
    text-decoration-thickness: 2px;
  }

  .blog-content pre {
    background-color: rgb(22, 22, 29);
    border-radius: 0.5rem;
    padding: 1rem;
    overflow-x: auto;
    margin: 1.5rem 0;
  }

  .blog-content code {
    font-family: "JetBrains Mono", monospace;
    font-size: 0.9em;
  }

  .blog-content ul,
  .blog-content ol {
    margin-bottom: 1.25em;
    padding-left: 1.5rem;
  }

  .blog-content ul {
    list-style-type: disc;
  }

  .blog-content ol {
    list-style-type: decimal;
  }

  .blog-content li {
    margin-bottom: 0.5em;
    line-height: 1.7;
  }

  .blog-content img {
    max-width: 100%;
    height: auto;
    border-radius: 0.5rem;
    margin: 1.5rem 0;
  }

  .blog-content blockquote {
    border-left: 4px solid var(--primary);
    padding-left: 1rem;
    font-style: italic;
    margin: 1.5rem 0;
    color: var(--muted-foreground);
  }

  @media (max-width: 768px) {
    .blog-content h1 {
      font-size: 1.75rem;
    }

    .blog-content h2 {
      font-size: 1.5rem;
    }

    .blog-content h3 {
      font-size: 1.25rem;
    }
  }
</style>
